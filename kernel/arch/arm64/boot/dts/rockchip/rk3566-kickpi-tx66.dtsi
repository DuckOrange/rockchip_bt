// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2021 Rockchip Electronics Co., Ltd.
 *
 */

/dts-v1/;

#include "rk3566-kickpi-box.dtsi"

#include "rk3566-kickpi-ir.dtsi"


/ {
	model = "Rockchip RK3566 BOX TX6S Linux Board";
	compatible = "rockchip,rk3566-box-tx6s", "rockchip,rk3566";
	
	// chosen {
	// 	//  resvered memory for kdump 
	// 	bootargs = "crashkernel=128M earlycon=uart8250,mmio32,0xfe660000 console=ttyFIQ0";
	// };
	
	ramoops_mem: ramoops_mem {
		reg = <0x0 0x110000 0x0 0xf0000>;
		reg-names = "ramoops_mem";
	};
	
	ramoops {
		compatible = "ramoops";
		record-size = <0x0 0x20000>;
		console-size = <0x0 0x80000>;
		ftrace-size = <0x0 0x00000>;
		pmsg-size = <0x0 0x50000>;
		memory-region = <&ramoops_mem>;
	};

	fd650_dev {
		  compatible = "oranth,fd650";
		  status = "okay";
		  clk_pin  = <&gpio0  11  GPIO_ACTIVE_HIGH>;
		  dat_pin  = <&gpio0  12  GPIO_ACTIVE_HIGH>;
	};

	vcc3v3_pcie: gpio-regulator {
		compatible = "regulator-fixed";
		// compatible = "regulator-gpio";
		regulator-name = "vcc3v3_pcie";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		enable-active-high;
		pinctrl-0 = <&wifi_enable_h>;
		pinctrl-names = "default";
		gpio = <&gpio2 RK_PB1 GPIO_ACTIVE_HIGH>; // ignore gpio control, because it is always high level
		// 默认需要delay
		regulator-always-on;
		regulator-on-in-suspend;
		startup-delay-us = <5000>;
		vin-supply = <&dc_12v>;
		
		regulator-state-mem {
			regulator-on-in-suspend;
		};
		regulator-state-disk {
			regulator-on-in-suspend;
		};
	};
};


// DDR
&dmc {
  //ddr_timing = <&ddr_timing>;
	// devfreq-events = <&dfi>;
	// clocks = <&cru SCLK_DDRCLK>;
  vop-bw-dmc-freq = <
  /* min_bw(MB/s) max_bw(MB/s) freq(KHz) */
        0           505        324000
        506         99999      1056000
  >;
  system-status-freq = <
    /* system status         freq level(KHz) */
    SYS_STATUS_NORMAL       1056000
    SYS_STATUS_REBOOT        324000
    SYS_STATUS_SUSPEND       324000
    SYS_STATUS_VIDEO_4K     1056000
    SYS_STATUS_VIDEO_4K_10B 1056000
    SYS_STATUS_BOOST        1056000
    SYS_STATUS_ISP          1056000
    SYS_STATUS_PERFORMANCE  1056000
    SYS_STATUS_DUALVIEW     1056000
  >;
	// ddr_power_model: ddr_power_model {
	// 	dynamic-power-coefficient = <120>;
	// 	static-power-coefficient = <300>;
	// 	ts = <32000 4700 (-80) 2>;
	// 	thermal-zone = "soc-thermal";
	// }
	auto-freq-en = <1>;
  status = "okay";
};

// &dmc_fsp {
//   status = "disabled";
// };

&dmc_opp_table {
	compatible = "operating-points-v2";
	mbist-vmin = <825000 900000 950000>;
	nvmem-cells = <&log_leakage>, <&core_pvtm>, <&mbist_vmin>;
	nvmem-cell-names = "leakage", "pvtm", "mbist-vmin";
	rockchip,temp-hysteresis = <5000>;
	rockchip,low-temp = <0>;
	rockchip,low-temp-adjust-volt = <
		/* MHz    MHz    uV */
		   0      1560   25000
	>;
	rockchip,leakage-voltage-sel = <
		1   80    0
		81  254   1
	>;
	opp-324000000 {
		opp-hz = /bits/ 64 <324000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
	};
	opp-528000000 {
		opp-hz = /bits/ 64 <528000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
	};
	
	opp-630000000 {
		opp-hz = /bits/ 64 <630000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
	};
	opp-780000000 {
		opp-hz = /bits/ 64 <780000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
	};
	opp-920000000 {
		opp-hz = /bits/ 64 <920000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
		status = "disabled";
	};
	opp-1056000000 {
		opp-hz = /bits/ 64 <1056000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
		status = "disabled";
	};
	opp-1560000000 {
		opp-hz = /bits/ 64 <1560000000>;
		opp-microvolt = <900000>;
		opp-microvolt-L0 = <900000>;
		opp-microvolt-L1 = <850000>;
		status = "disabled";
	};
};

// io_domains
&pmu_io_domains {
	status = "okay";
	pmuio2-supply = <&vcc_3v3>;
	vccio1-supply = <&vcc_3v3>;
	vccio3-supply = <&vcc_3v3>;
	vccio4-supply = <&vcc_1v8>;
	vccio5-supply = <&vcc_3v3>;
	vccio6-supply = <&vcc_1v8>;
	vccio7-supply = <&vcc_3v3>;
};

/************************ rk3566-box.dtsi ************/
// NPU
&rknpu {
	memory-region = <&rknpu_reserved>;
	rknpu-supply = <&vdd_fixed>;
	status = "okay";
};

&rknpu_mmu {
	status = "disabled";
};

&reserved_memory {
	#address-cells = <2>;
	#size-cells = <2>;
	ranges;

	rknpu_reserved: rknpu {
		compatible = "shared-dma-pool";
		inactive;
		reusable;
		size = <0x0 0x20000000>;
		alignmemt = <0x0 0x1000>;
		status = "disabled";
	};
};

&sfc {
	status = "okay";

	flash@0 {
		compatible = "spi-nand";
		reg = <0>;
		spi-max-frequency = <75000000>;
		spi-rx-bus-width = <4>;
		spi-tx-bus-width = <1>;
	};
};


&rockchip_suspend {
  rockchip,sleep-debug-en = <1>;
	rockchip,virtual-poweroff = <1>;
};

&hdmi_sound {
  simple-audio-card,mclk-fs = <256>;
};

/*********************************/

&sata1 {
	// box不需要sata功能
	status = "disabled";
};

&sata2 {
	// sata 和 pcie2x1所属同一phy,关闭
	status = "disabled";
};
&pcie2x1 {
	phys = <&combphy2_psq PHY_TYPE_PCIE>;
	reset-gpios = <&gpio1 RK_PB2 GPIO_ACTIVE_HIGH>;
	rockchip,skip-scan-in-resume;
	vpcie3v3-supply = <&vcc3v3_pcie>;
	status = "okay";
};
